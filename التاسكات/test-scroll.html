<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            padding: 2rem;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 2rem;
        }
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #3498db;
            margin-bottom: 1rem;
        }
        .status {
            padding: 0.5rem;
            border-radius: 3px;
            margin: 0.5rem 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn.danger {
            background: #e74c3c;
        }
        .btn.danger:hover {
            background: #c0392b;
        }
        .btn.success {
            background: #27ae60;
        }
        .btn.success:hover {
            background: #229954;
        }
        .scroll-test {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 1rem;
            margin: 1rem 0;
        }
        .scroll-content {
            height: 1000px;
            background: linear-gradient(to bottom, #3498db, #e74c3c);
            color: white;
            padding: 1rem;
            text-align: center;
        }
        .chart-test {
            width: 100%;
            height: 200px;
            background: #ecf0f1;
            border: 1px solid #bdc3c7;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ø³ÙƒØ±ÙˆÙ„</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <div id="systemStatus"></div>
            <button class="btn" onclick="checkSystemStatus()">ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„</h3>
            <div class="scroll-test" id="scrollTest">
                <div class="scroll-content">
                    <h4>Ù…Ù†Ø·Ù‚Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„</h4>
                    <p>Ù‚Ù… Ø¨Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù‡Ù†Ø§ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ</p>
                    <div style="margin-top: 200px;">
                        <p>Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠØŒ ÙØ§Ù„Ø¥ØµÙ„Ø§Ø­ Ù†Ø¬Ø­</p>
                    </div>
                    <div style="margin-top: 200px;">
                        <p>Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø³ÙƒØ±ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙÙ‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø©</p>
                    </div>
                    <div style="margin-top: 200px;">
                        <p>Ù†Ù‡Ø§ÙŠØ© Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                    </div>
                </div>
            </div>
            <div id="scrollStatus"></div>
            <button class="btn" onclick="testScroll()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„</button>
            <button class="btn danger" onclick="resetScroll()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ˆ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</h3>
            <div class="chart-test" id="chartTest">
                <div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
            <div id="chartStatus"></div>
            <button class="btn" onclick="testChart()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</button>
            <button class="btn danger" onclick="stopAllIntervals()">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ</h3>
            <button class="btn" onclick="showDiagnostics()">Ø¹Ø±Ø¶ Ø§Ù„ØªØ´Ø®ÙŠØµ</button>
            <button class="btn success" onclick="window.open('index.html', '_blank')">ÙØªØ­ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            <button class="btn danger" onclick="clearAllData()">Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
            <div id="eventLog" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 1rem; border: 1px solid #dee2e6;"></div>
            <button class="btn" onclick="clearLog()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>
    </div>

    <script>
        let scrollEvents = 0;
        let chartUpdateCount = 0;
        let eventLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            eventLog.push(`[${timestamp}] ${message}`);
            
            const logElement = document.getElementById('eventLog');
            const statusClass = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'success';
            logElement.innerHTML = eventLog.map(entry => `<div class="status ${statusClass}">${entry}</div>`).join('');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            let html = '';
            
            // ÙØ­Øµ LocalStorage
            const hasLocalStorage = typeof(Storage) !== "undefined";
            html += `<div class="status ${hasLocalStorage ? 'success' : 'error'}">
                LocalStorage: ${hasLocalStorage ? 'âœ… Ù…Ø¯Ø¹ÙˆÙ…' : 'âŒ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'}
            </div>`;
            
            // ÙØ­Øµ Chart.js
            const hasChart = typeof Chart !== 'undefined';
            html += `<div class="status ${hasChart ? 'success' : 'error'}">
                Chart.js: ${hasChart ? 'âœ… Ù…Ø­Ù…Ù„' : 'âŒ ØºÙŠØ± Ù…Ø­Ù…Ù„'}
            </div>`;
            
            // ÙØ­Øµ Service Worker
            const hasServiceWorker = 'serviceWorker' in navigator;
            html += `<div class="status ${hasServiceWorker ? 'success' : 'warning'}">
                Service Worker: ${hasServiceWorker ? 'âœ… Ù…Ø¯Ø¹ÙˆÙ…' : 'âš ï¸ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'}
            </div>`;
            
            // ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø®ØµØµØ©
            const hasScrollFix = typeof stopAllIntervals === 'function';
            html += `<div class="status ${hasScrollFix ? 'success' : 'error'}">
                Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ø³ÙƒØ±ÙˆÙ„: ${hasScrollFix ? 'âœ… Ù…Ø­Ù…Ù„Ø©' : 'âŒ ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©'}
            </div>`;
            
            statusDiv.innerHTML = html;
            log('ØªÙ… ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…', hasLocalStorage && hasChart ? 'info' : 'warning');
        }
        
        function testScroll() {
            const scrollTest = document.getElementById('scrollTest');
            const statusDiv = document.getElementById('scrollStatus');
            
            scrollEvents = 0;
            let testDuration = 5000; // 5 Ø«ÙˆØ§Ù†
            let startTime = Date.now();
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³ÙƒØ±ÙˆÙ„
            const scrollHandler = () => {
                scrollEvents++;
            };
            
            scrollTest.addEventListener('scroll', scrollHandler);
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            let autoScrollInterval = setInterval(() => {
                scrollTest.scrollTop += 10;
            }, 100);
            
            setTimeout(() => {
                clearInterval(autoScrollInterval);
                scrollTest.removeEventListener('scroll', scrollHandler);
                
                let status = '';
                if (scrollEvents > 100) {
                    status = `<div class="status error">âŒ Ø³ÙƒØ±ÙˆÙ„ Ù…ÙØ±Ø·: ${scrollEvents} Ø­Ø¯Ø«</div>`;
                    log(`Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ ÙØ´Ù„: ${scrollEvents} Ø­Ø¯Ø«`, 'error');
                } else if (scrollEvents > 50) {
                    status = `<div class="status warning">âš ï¸ Ø³ÙƒØ±ÙˆÙ„ ÙƒØ«ÙŠØ±: ${scrollEvents} Ø­Ø¯Ø«</div>`;
                    log(`Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„: ØªØ­Ø°ÙŠØ± ${scrollEvents} Ø­Ø¯Ø«`, 'warning');
                } else {
                    status = `<div class="status success">âœ… Ø³ÙƒØ±ÙˆÙ„ Ø·Ø¨ÙŠØ¹ÙŠ: ${scrollEvents} Ø­Ø¯Ø«</div>`;
                    log(`Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù†Ø¬Ø­: ${scrollEvents} Ø­Ø¯Ø«`, 'info');
                }
                
                statusDiv.innerHTML = status;
            }, testDuration);
            
            log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„...', 'info');
        }
        
        function testChart() {
            const chartTest = document.getElementById('chartTest');
            const statusDiv = document.getElementById('chartStatus');
            
            chartUpdateCount = 0;
            
            // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
            chartTest.innerHTML = '<div style="color: #3498db;">ğŸ“Š Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠ</div>';
            
            let updateInterval = setInterval(() => {
                chartUpdateCount++;
                chartTest.innerHTML = `<div style="color: #3498db;">ğŸ“Š ØªØ­Ø¯ÙŠØ« #${chartUpdateCount}</div>`;
                
                if (chartUpdateCount > 10) {
                    clearInterval(updateInterval);
                    statusDiv.innerHTML = '<div class="status error">âŒ ØªØ­Ø¯ÙŠØ« Ù…ÙØ±Ø· Ù„Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</div>';
                    log('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ÙØ´Ù„: ØªØ­Ø¯ÙŠØ« Ù…ÙØ±Ø·', 'error');
                }
            }, 100);
            
            setTimeout(() => {
                clearInterval(updateInterval);
                if (chartUpdateCount <= 10) {
                    statusDiv.innerHTML = '<div class="status success">âœ… ØªØ­Ø¯ÙŠØ« Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</div>';
                    log('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù†Ø¬Ø­', 'info');
                }
            }, 2000);
            
            log('Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ...', 'info');
        }
        
        function showDiagnostics() {
            const diagnostics = {
                'Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³ÙƒØ±ÙˆÙ„': scrollEvents,
                'ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ': chartUpdateCount,
                'Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©': performance.memory ? 
                    Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + ' MB' : 'ØºÙŠØ± Ù…ØªØ§Ø­',
                'ÙˆÙ‚Øª Ø§Ù„ØªØ´ØºÙŠÙ„': Math.round(performance.now() / 1000) + ' Ø«Ø§Ù†ÙŠØ©'
            };
            
            let message = 'ØªØ´Ø®ÙŠØµ Ø§Ù„Ù†Ø¸Ø§Ù…:\n';
            Object.entries(diagnostics).forEach(([key, value]) => {
                message += `${key}: ${value}\n`;
            });
            
            alert(message);
            log('ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØªØ´Ø®ÙŠØµ', 'info');
        }
        
        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                localStorage.clear();
                sessionStorage.clear();
                log('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
                alert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
            }
        }
        
        function clearLog() {
            eventLog = [];
            document.getElementById('eventLog').innerHTML = '';
            log('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„', 'info');
        }
        
        // Ø¯ÙˆØ§Ù„ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªØ§Ø­Ø©)
        window.stopAllIntervals = window.stopAllIntervals || function() {
            log('Ø¯Ø§Ù„Ø© stopAllIntervals ØºÙŠØ± Ù…ØªØ§Ø­Ø©', 'warning');
        };
        
        window.resetScroll = window.resetScroll || function() {
            window.scrollTo(0, 0);
            document.getElementById('scrollTest').scrollTop = 0;
            scrollEvents = 0;
            log('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³ÙƒØ±ÙˆÙ„', 'info');
        };
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        document.addEventListener('DOMContentLoaded', () => {
            log('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„', 'info');
            setTimeout(checkSystemStatus, 1000);
        });
        
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        window.addEventListener('error', (e) => {
            log(`Ø®Ø·Ø£: ${e.message}`, 'error');
        });
        
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…
        let globalScrollCount = 0;
        window.addEventListener('scroll', () => {
            globalScrollCount++;
            if (globalScrollCount > 50) {
                log('ØªØ­Ø°ÙŠØ±: Ø³ÙƒØ±ÙˆÙ„ Ù…ÙØ±Ø· ÙÙŠ Ø§Ù„ØµÙØ­Ø©', 'warning');
                globalScrollCount = 0;
            }
        });
    </script>
</body>
</html>